<%# app/views/audit_corrections/index.html.erb %>
<div class="audit-corrections-container">
  
  <%# ZONA FIJA: Header + Buscador %>
  <div class="page-header-sticky">
    <header class="page-header">
      <div class="page-header-content">
        <h2 class="page-title">M√≥dulo de Correcciones</h2>
        <p class="page-subtitle">Auditor√≠a de movimientos aprobados y sincronizaci√≥n con Kafka.</p>
      </div>
      <div id="results-counter" class="results-counter">
        Mostrando registros recientes
      </div>
    </header>

    <%# Buscador Estilizado %>
    <%= form_with url: audit_corrections_path, method: :get, 
                  data: { controller: "search", turbo_action: "advance" }, 
                  class: "search-container" do |f| %>
      
      <div class="search-field-wrapper">
        <span class="search-icon">üîç</span>
        <%= f.text_field :query, 
              placeholder: "Buscar por ID, detalle o categor√≠a...", 
              value: params[:query],
              autocomplete: "off",
              data: { action: "input->search#submit" }, 
              class: "input-search-ux search-input-with-icon" %>
      </div>
      
      <div class="search-field-wrapper-date">
        <%= f.date_field :fecha, 
              value: params[:fecha],
              data: { action: "change->search#submit" }, 
              class: "input-search-ux" %>
      </div>
    <% end %>
  </div>

  <%# CONTENEDOR DE RESULTADOS %>
  <div id="audit_results_container" class="audit-results-container">
    <%= render partial: "transaction", collection: @records %>
  </div>

  <%# SCROLL INFINITO %>
  <div id="next_page" class="audit-pagination-container">
    <% if @pagy.next %>
      <%= turbo_frame_tag "audit_table_next", 
            src: audit_corrections_path(page: @pagy.next, query: params[:query], format: :turbo_stream), 
            loading: :lazy %>
    <% end %>
  </div>
</div>

<div id="modal-container"></div>