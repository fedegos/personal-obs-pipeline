<%# app/views/audit_corrections/edit.turbo_stream.erb %>
<%= turbo_stream.update "modal-container" do %>
  <div id="modal-overlay" style="position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(4px); z-index: 50; display: flex; align-items: center; justify-content: center; padding: 20px;">
    <div style="background: white; border-radius: 20px; width: 100%; max-width: 500px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); position: relative; overflow: hidden;">
      
      <button type="button" onclick="document.getElementById('modal-overlay').remove()" 
              style="position: absolute; top: 16px; right: 16px; background: #f1f5f9; border: none; width: 32px; height: 32px; border-radius: 50%; color: #64748b; cursor: pointer; font-weight: bold; z-index: 1;">âœ•</button>

      <div style="padding: 32px;">
        <div class="audit-modal-header" style="margin-bottom: 24px; display: flex; justify-content: space-between; align-items: flex-start; padding-right: 48px;">
          <div>
            <h3 style="margin: 0; color: #0f172a; font-size: 1.25rem;">Corregir TransacciÃ³n</h3>
            <p style="margin: 4px 0 0; color: #64748b; font-size: 0.8rem; font-family: monospace;">UUID: <%= @transaction.event_id.last(12) %></p>
          </div>
          <div style="display: flex; gap: 8px;">
            <%= link_to "â† Anterior", prev_audit_correction_path(@transaction, request.query_parameters.slice("query", "fecha")), 
                data: { turbo_frame: "_top", turbo_prefetch: false }, 
                class: "btn-audit-nav" %>
            <%= link_to "Siguiente â†’", next_audit_correction_path(@transaction, request.query_parameters.slice("query", "fecha")), 
                data: { turbo_frame: "_top", turbo_prefetch: false }, 
                class: "btn-audit-nav" %>
          </div>
        </div>

        <%= form_with model: @transaction, url: audit_correction_path(@transaction), method: :patch do |f| %>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; background: #f8fafc; padding: 16px; border-radius: 12px; border: 1px solid #e2e8f0;">
            <span style="font-size: 0.9rem; color: #475569; font-weight: 600;">ðŸ“… <%= @transaction.fecha.strftime("%d %b, %Y") %></span>
            <span style="font-size: 1.25rem; font-weight: 900; color: #0f172a;"><%= number_to_currency(@transaction.monto) %></span>
          </div>

          <div style="font-size: 1rem; color: #334155; margin-bottom: 24px; font-weight: 500; line-height: 1.5; padding: 0 4px;">
            <%= @transaction.detalles %>
          </div>

          <%# LLAMADA AL PARTIAL EXTRAÃDO %>
          <%= render "shared/transaction_form_fields", 
                     f: f, 
                     categories_map: @categories_map, 
                     categories_list: @categories_list %>

          <div class="button-grid-modal">
            <%= f.submit "âœ… Guardar Cambios", class: "btn-submit-dark" %>
            <button type="button" onclick="document.getElementById('modal-overlay').remove()" class="btn-cancel-soft">
              Cancelar
            </button>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>