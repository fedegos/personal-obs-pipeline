<!DOCTYPE html>
<html>
  <head>
    <title>Audit-X 2026</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body style="margin: 0; background: #f8fafc; font-family: system-ui, sans-serif; display: flex; max-width: 100vw; overflow-x: hidden;">
    
   <!-- 1. SIDEBAR FIJO (260px) -->
  <nav style="width: 260px; height: 100vh; background: #1e293b; color: white; position: fixed; left: 0; top: 0; display: flex; flex-direction: column; z-index: 1000;">
    <div style="padding: 24px; font-size: 1.5rem; font-weight: bold; border-bottom: 1px solid #334155; display: flex; align-items: center; gap: 10px;">
      <span>ğŸ’°</span> Audit-X
    </div>

    <div style="flex: 1; padding: 20px 0;">
      <div style="padding: 0 24px 10px; font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.05em;">Operaciones</div>
      <%= link_to transactions_path, class: "nav-link #{'active' if controller_name == 'transactions'}" do %>
        <span style="width: 24px;">ğŸ“‹</span> Pendientes
      <% end %>

      <div style="height: 20px;"></div>
      
      <div style="padding: 0 24px 10px; font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.05em;">AuditorÃ­a</div>
        <%= link_to audit_corrections_path, class: "nav-link #{'active' if controller_name == 'audit_corrections'}" do %>
        <span style="width: 24px;">ğŸ“</span> Correcciones
      <% end %>

      <div style="height: 20px;"></div>

      <div style="padding: 0 24px 10px; font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.05em;">Inteligencia</div>
      <%= link_to category_rules_path, class: "nav-link #{'active' if controller_name == 'category_rules'}" do %>
        <span style="width: 24px;">âš™ï¸</span> Reglas de Motor
      <% end %>

      <div style="height: 20px;"></div>

      <div style="padding: 0 24px 10px; font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.05em;">Sistema</div>
      <%= link_to upload_path, class: "nav-link #{'active' if controller_name == 'source_files'}" do %>
        <span style="width: 24px;">ğŸ“¤</span> Ingesta de Datos
      <% end %>
    </div>

    <!-- SECCIÃ“N DE USUARIO INTEGRADA -->
    <% if user_signed_in? %>
      <div style="padding: 16px; background: #0f172a; border-top: 1px solid #334155;">
        <div style="padding: 0 8px 10px; font-size: 0.65rem; color: #64748b; text-transform: uppercase;">SesiÃ³n Activa</div>
        <div style="display: flex; align-items: center; gap: 12px; padding: 0 8px;">
          <div style="flex: 1; min-width: 0;">
            <div style="font-size: 0.85rem; color: #f1f5f9; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="<%= current_user.email %>">
              <%= current_user.email.split('@').first %>
            </div>
          </div>
          <%= link_to destroy_user_session_path, 
                      data: { turbo_method: :delete }, 
                      class: "logout-icon", 
                      title: "Cerrar SesiÃ³n" do %>
            <span style="font-size: 1.1rem;">ğŸšª</span>
          <% end %>
        </div>
      </div>
    <% end %>

    <div style="padding: 16px 24px; font-size: 0.75rem; color: #64748b; border-top: 1px solid #334155;">
      v1.2.0-2026
    </div>
  </nav>

    <!-- 2. AREA DE CONTENIDO (Ancho dinÃ¡mico) -->
    <main style="margin-left: 260px; width: calc(100% - 260px); min-height: 100vh; box-sizing: border-box; position: relative;">
      
      <!-- Contenedor de Notificaciones -->
      <div id="flash-container" style="position: fixed; top: 20px; left: calc(50% + 130px); transform: translateX(-50%); z-index: 9999; pointer-events: none;">
        <%= render "shared/flash" %>
      </div>

      <!-- Padding interno -->
      <div style="padding: 40px; box-sizing: border-box;">
        <%= yield %>
      </div>
    </main>

    <style>
      .nav-link {
        display: flex;
        align-items: center;
        padding: 12px 24px;
        color: #cbd5e1;
        text-decoration: none;
        transition: all 0.2s;
        font-size: 0.95rem;
      }
      .nav-link:hover {
        background: #334155;
        color: white;
      }
      .nav-link.active {
        background: #3b82f6;
        color: white;
        border-right: 4px solid #fff;
      }
      .logout-icon {
        background: #334155;
        padding: 6px;
        border-radius: 6px;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
      }
      .logout-icon:hover {
        background: #ef4444; /* Rojo al hacer hover */
      }
    </style>
  </body>
</html>
