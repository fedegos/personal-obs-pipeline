<%# app/views/category_rules/index.html.erb %>
<div style="max-width: 800px; margin: 0 auto; padding-bottom: 40px;">
  
  <header style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px;">
    <div>
      <h1 style="font-size: 1.5rem; color: #1e293b; margin: 0;">‚öôÔ∏è Motor de Reglas</h1>
      <p style="color: #64748b; font-size: 0.9rem; margin-top: 4px;">Configura la l√≥gica de categorizaci√≥n autom√°tica.</p>
    </div>
    <%= link_to new_category_rule_path, style: "background: #3b82f6; color: white; padding: 10px 18px; border-radius: 8px; text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3);" do %>
      <span>‚ûï</span> <span style="display: inline;">Nueva Regla</span>
    <% end %>
  </header>

  <% if @category_rules.any? %>
    <div style="display: grid; gap: 12px; grid-template-columns: 1fr;">
      <% @category_rules.order(parent_id: :asc, priority: :desc).each do |rule| %>
        <div style="background: white; border-radius: 12px; border: 1px solid #e2e8f0; padding: 16px; display: flex; flex-direction: column; gap: 12px; position: relative;">
          
          <%# Fila Superior: Nombre y Jerarqu√≠a %>
          <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div style="display: flex; flex-direction: column; gap: 4px;">
              <div style="display: flex; align-items: center; gap: 8px;">
                <span style="font-weight: 700; color: #0f172a; font-size: 1.05rem;"><%= rule.name %></span>
                <% if rule.parent_id.nil? %>
                  <span style="font-size: 0.65rem; background: #dcfce7; color: #166534; padding: 2px 8px; border-radius: 20px; font-weight: bold; text-transform: uppercase;">Ra√≠z</span>
                <% end %>
              </div>
              <% if rule.parent %>
                <div style="font-size: 0.8rem; color: #64748b; display: flex; align-items: center; gap: 4px;">
                  <span>‚Ü≥ pertenece a</span>
                  <strong style="color: #475569;"><%= rule.parent.name %></strong>
                </div>
              <% end %>
            </div>
            
            <%# Badge de Prioridad %>
            <div style="text-align: right; background: #f8fafc; padding: 4px 10px; border-radius: 6px; border: 1px solid #f1f5f9;">
              <div style="font-size: 0.6rem; color: #94a3b8; text-transform: uppercase; font-weight: bold;">Prioridad</div>
              <div style="font-weight: 800; font-size: 0.9rem; color: #475569;"><%= rule.priority %></div>
            </div>
          </div>

          <%# Fila Media: El Patr√≥n Regex %>
          <div style="background: #fdf2f2; border: 1px solid #fee2e2; padding: 8px 12px; border-radius: 6px;">
            <code style="color: #dc2626; font-size: 0.85rem; font-family: ui-monospace, monospace; word-break: break-all;">
              <%= rule.pattern %>
            </code>
          </div>

          <%# Fila Inferior: Acciones %>
          <div style="display: flex; justify-content: flex-end; gap: 12px; border-top: 1px solid #f1f5f9; pt: 12px; margin-top: 4px; padding-top: 12px;">
            <%= link_to "‚úèÔ∏è Editar", edit_category_rule_path(rule), style: "text-decoration: none; font-size: 0.85rem; color: #3b82f6; font-weight: 600;" %>
            
            <%= button_to rule, method: :delete, data: { confirm: "¬øEliminar esta regla?" }, 
                style: "background: none; border: none; padding: 0; cursor: pointer; font-size: 0.85rem; color: #ef4444; font-weight: 600;" do %>
              üóëÔ∏è Eliminar
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div style="text-align: center; padding: 40px; background: #f8fafc; border: 2px dashed #cbd5e0; border-radius: 12px;">
      <p style="color: #64748b;">No hay reglas configuradas a√∫n. Comienza creando una categor√≠a ra√≠z.</p>
    </div>
  <% end %>
</div>
