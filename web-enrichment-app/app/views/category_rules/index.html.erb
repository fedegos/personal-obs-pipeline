<%# app/views/category_rules/index.html.erb %>
<div class="page-container">
  
  <header class="page-header">
    <div class="page-header-content">
      <h1 class="page-title">‚öôÔ∏è Motor de Reglas</h1>
      <p class="page-subtitle">Configura la l√≥gica de categorizaci√≥n autom√°tica.</p>
    </div>
    <%= link_to new_category_rule_path, class: "btn-primary-action" do %>
      <span>‚ûï</span> <span>Nueva Regla</span>
    <% end %>
  </header>

  <% if @category_rules.any? %>
    <div class="grid-single-column">
      <% @category_rules.order(parent_id: :asc, priority: :desc).each do |rule| %>
        <div class="category-rule-card">
          
          <%# Fila Superior: Nombre y Jerarqu√≠a %>
          <div class="category-rule-header">
            <div class="category-rule-name-section">
              <div class="category-rule-name-row">
                <span class="category-rule-name"><%= rule.name %></span>
                <% if rule.parent_id.nil? %>
                  <span class="category-rule-badge-root">Ra√≠z</span>
                <% end %>
              </div>
              <% if rule.parent %>
                <div class="category-rule-parent-info">
                  <span>‚Ü≥ pertenece a</span>
                  <strong class="category-rule-parent-name"><%= rule.parent.name %></strong>
                </div>
              <% end %>
            </div>
            
            <%# Badge de Prioridad %>
            <div class="category-rule-priority-badge">
              <div class="category-rule-priority-label">Prioridad</div>
              <div class="category-rule-priority-value"><%= rule.priority %></div>
            </div>
          </div>

          <%# Fila Media: El Patr√≥n Regex %>
          <div class="category-rule-pattern">
            <code class="category-rule-pattern-code">
              <%= rule.pattern %>
            </code>
          </div>

          <%# Fila Inferior: Acciones %>
          <div class="category-rule-footer">
            <%= link_to "‚úèÔ∏è Editar", edit_category_rule_path(rule), class: "btn-action-link" %>
            
            <%= button_to rule, method: :delete, data: { confirm: "¬øEliminar esta regla?" }, 
                class: "btn-action-delete" do %>
              üóëÔ∏è Eliminar
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <%= render "shared/empty_state", 
          simple: true,
          message: "No hay reglas configuradas a√∫n. Comienza creando una categor√≠a ra√≠z." %>
  <% end %>
</div>
