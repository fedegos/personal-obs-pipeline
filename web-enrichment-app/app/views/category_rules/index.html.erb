<%# Motor de Reglas: single page con sticky header, filtro por sentimiento y edición en modal %>
<div class="category-rules-page">
  <div class="page-header-sticky">
    <header class="page-header">
      <div class="page-header-content">
        <h1 class="page-title">⚙️ Motor de Reglas</h1>
        <p class="page-subtitle">Configura la lógica de categorización automática.</p>
      </div>
      <%= link_to new_category_rule_path(format: :turbo_stream), class: "btn-primary-action", data: { turbo_prefetch: false } do %>
        <span>➕</span> <span>Nueva Regla</span>
      <% end %>
    </header>

    <%= form_with url: category_rules_path, method: :get, data: { controller: "category-rules-filter", turbo_frame: "_top" }, class: "category-rules-filter-form" do |f| %>
      <label for="filter_sentimiento" class="category-rules-filter-label">Filtrar por sentimiento:</label>
      <%= f.select :sentimiento,
            options_for_select(
              [["Todos", ""], ["— Sin definir", "_blank"]] + Transaction::SENTIMIENTOS.map { |k, v| [v, k] },
              params[:sentimiento]
            ),
            {},
            {
              id: "filter_sentimiento",
              class: "category-rules-filter-select",
              data: { action: "change->category-rules-filter#submit" }
            } %>
    <% end %>
  </div>

  <div id="category_rules_list" class="grid-single-column">
    <%= render partial: "rule_card", collection: @category_rules, as: :rule %>
  </div>
  <% if @category_rules.empty? %>
    <div id="category_rules_empty" class="category-rules-empty-wrapper">
      <%= render "shared/empty_state",
            simple: true,
            message: params[:sentimiento].present? ? "No hay reglas con ese sentimiento." : "No hay reglas configuradas aún. Comienza creando una categoría raíz." %>
    </div>
  <% end %>
</div>

<div id="modal-container"></div>
