<%# 1. Datalist para autocompletado inteligente %>
<datalist id="categories-suggestions">
  <% @categories_list.each do |cat| %>
    <option value="<%= cat %>">
  <% end %>
</datalist> 

<div style="font-family: system-ui, -apple-system, sans-serif; padding: 20px; max-width: 1250px; margin: 0 auto; color: #333;">
  <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
    <h1 style="font-size: 1.5rem; margin: 0;">ðŸ’° Enriquecimiento de Gastos</h1>
    <div style="text-align: right;">
      <p style="color: #28a745; font-weight: bold; margin: 0;"><%= notice %></p>
      <p style="color: #dc3545; margin: 0;"><%= alert %></p>
    </div>
  </header>

  <hr style="border: 0; border-top: 1px solid #eee; margin-bottom: 25px;">

  <% if @pending.any? %>
    <div style="overflow-x: auto; border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);">
      <table style="width: 100%; border-collapse: collapse; background: white; min-width: 900px;">
        <thead>
          <tr style="background: #f8f9fa; text-align: left; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.05em;">
            <th style="padding: 16px; border-bottom: 2px solid #dee2e6; width: 100px;">Fecha</th>
            <th style="padding: 16px; border-bottom: 2px solid #dee2e6;">DescripciÃ³n</th>
            <th style="padding: 16px; border-bottom: 2px solid #dee2e6; width: 120px;">Monto</th>
            <th style="padding: 16px; border-bottom: 2px solid #dee2e6; width: 400px;">CategorizaciÃ³n (Elegir o Crear)</th>
            <th style="padding: 16px; border-bottom: 2px solid #dee2e6; width: 100px;">AcciÃ³n</th>
          </tr>
        </thead>
        <tbody id="transactions-table-body">
          <% @pending.each do |t| %>
            <tr id="<%= dom_id(t) %>" style="border-bottom: 1px solid #f0f0f0; transition: background 0.2s;" onmouseover="this.style.backgroundColor='#fafafa'" onmouseout="this.style.backgroundColor='transparent'">
              <td style="padding: 16px; font-size: 0.9rem; color: #666;"><%= t.fecha.strftime("%d/%m/%Y") %></td>
              <td style="padding: 16px;">
                <div style="font-size: 0.85rem; font-weight: 500; color: #1a1a1a;"><%= t.detalles %></div>
                <div style="font-size: 0.7rem; color: #999; margin-top: 4px;"><%= t.red %></div>
              </td>
              <td style="padding: 16px; font-weight: 600; color: #2d3748;"><%= number_to_currency(t.monto) %></td>
              
              <%= form_with model: t, url: approve_transaction_path(t), method: :patch do |f| %>
                <td style="padding: 16px;">
                  <div data-controller="combo" style="display: flex; gap: 6px;">
                    <%# CategorÃ­a con Datalist: Permite elegir de la lista o escribir algo nuevo %>
                    <%= f.text_field :categoria, 
                        list: "categories-suggestions", 
                        placeholder: "Cat...", 
                        autocomplete: "off",
                        data: { 
                          combo_target: "input", # Debe coincidir con static targets en el JS
                          action: "input->combo#checkNew" # Evento 'input' llama a 'checkNew'
                        },
                        style: "width: 120px; padding: 6px 10px; border: 1px solid #cbd5e0; border-radius: 4px; font-size: 0.85rem;" %>
                    
                    <%= f.text_field :sub_categoria, 
                        placeholder: "Sub...", 
                        style: "width: 100px; padding: 6px 10px; border: 1px solid #cbd5e0; border-radius: 4px; font-size: 0.85rem;" %>
                    
                    <%= f.select :sentimiento, 
                        ['Necesario', 'Deseo', 'InversiÃ³n'], 
                        {}, 
                        { style: "width: 120px; padding: 6px 10px; border: 1px solid #cbd5e0; border-radius: 4px; font-size: 0.85rem; background: white;" } %>
                  </div>
                </td>
                <td style="padding: 16px;">
                  <%= f.submit "âœ… Aprobar", 
                      style: "background: #38a169; color: white; border: none; padding: 8px 14px; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 0.85rem; white-space: nowrap;",
                      onmouseover: "this.style.background='#2f855a'",
                      onmouseout: "this.style.background='#38a169'" %>
                </td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div id="empty-state" style="text-align: center; padding: 80px 20px; background: #f9f9f9; border-radius: 12px; border: 2px dashed #cbd5e0; margin-top: 20px;">
      <div style="font-size: 3rem; margin-bottom: 20px;">ðŸŽ‰</div>
      <h2 style="color: #4a5568; margin: 0;">Â¡Todo al dÃ­a!</h2>
      <p style="color: #718096; margin-top: 10px;">No hay transacciones pendientes de aprobaciÃ³n. Tus dashboards en Grafana estÃ¡n actualizados.</p>
    </div>
  <% end %>
</div>


